{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}


<div class="dashboard-layout">

  <!-- ğŸ›ï¸ DASHBOARD PANEL I MITTEN -->
  <div class="dashboard-panel">
    <h2>VÃ¤lkommen, {{ user.display_name or user.username }}!</h2>

    {# â€”â€”â€” Mobilâ€fÃ¶rhandsvisning â€”â€”â€” #}
    <div class="mobile-only">
      <div class="mobile-preview {{ user.template }}"
           style="font-family: {{ user.font_family | default('Inter, sans-serif') }};
                  color: {{ user.theme_color or '#fff' }}; margin-bottom:1rem;">

        <div class="profile-card {{ user.template }}"
             style="font-family: inherit; color: inherit;">
          {# â€”â€” Profilbild fÃ¶r mobilvy â€”â€” #}
          {% if user.profile_image %}
            {% if config['UPLOAD_FOLDER'].startswith('/user/data') %}
              {# PÃ¥ Render: hÃ¤mta frÃ¥n /uploads/filnamn #}
              <img src="{{ url_for('uploaded_file', filename=user.profile_image) }}" class="profile-img">
            {% else %}
              {# Lokalt: hÃ¤mta frÃ¥n /static/uploads/filnamn #}
              <img src="{{ url_for('static', filename='uploads/' ~ user.profile_image) }}" class="profile-img">
            {% endif %}
          {% else %}
            {# Ingen profilbild â†’ visa defaultbild #}
            <img src="{{ url_for('static', filename='uploads/default-profile.png') }}" class="profile-img">
          {% endif %}

          <h3>@{{ user.display_name or user.username }}</h3>
          <p>{{ user.bio or "Ingen beskrivning Ã¤nnu." }}</p>
          <!-- â€”â€”â€” Kontaktâ€ikoner Ã¤ven i mobilâ€vyn â€”â€”â€” -->
          <div class="contact-icons">
            {% if user.show_email %}
              <a href="mailto:{{ user.email }}" class="small-icon-btn">
                <i class="fas fa-envelope"></i>
              </a>
            {% endif %}
            {% if user.show_phone %}
              <a href="tel:{{ user.phone_number }}" class="small-icon-btn">
                <i class="fas fa-phone"></i>
              </a>
            {% endif %}
          </div>

          <div class="links" id="preview-links">
            {% for link in sorted_links if link.is_visible %}
              {% set icon = "" %}
              {% if "instagram" in link.url %}{% set icon = "fab fa-instagram" %}
              {% elif "facebook"   in link.url %}{% set icon = "fab fa-facebook" %}
              {% elif "linkedin"   in link.url %}{% set icon = "fab fa-linkedin" %}
              {% elif "youtube"    in link.url %}{% set icon = "fab fa-youtube" %}
              {% elif "twitter"    in link.url %}{% set icon = "fab fa-twitter" %}
              {% elif "github"     in link.url %}{% set icon = "fab fa-github" %}
              {% elif "snapchat"   in link.url %}{% set icon = "fab fa-snapchat" %}
              {% elif "spotify.com"    in link.url %}{% set icon = "fab fa-spotify" %}
              {% elif "soundcloud.com" in link.url %}{% set icon = "fab fa-soundcloud" %}
              {% elif "vimeo.com"      in link.url %}{% set icon = "fab fa-vimeo-v" %}
              {% elif "twitch.tv"      in link.url %}{% set icon = "fab fa-twitch" %}
              {% elif "dribbble.com"   in link.url %}{% set icon = "fab fa-dribbble" %}
              {% elif "behance.net"    in link.url %}{% set icon = "fab fa-behance" %}
              {% elif "medium.com"     in link.url %}{% set icon = "fab fa-medium" %}
              {% elif "pinterest.com"  in link.url %}{% set icon = "fab fa-pinterest" %}
              {% elif "reddit.com"     in link.url %}{% set icon = "fab fa-reddit" %}
              {% elif "tumblr.com"     in link.url %}{% set icon = "fab fa-tumblr" %}
              {% elif "whatsapp.com"   in link.url %}{% set icon = "fab fa-whatsapp" %}
              {% elif "telegram.me"    in link.url %}{% set icon = "fab fa-telegram" %}
              {% elif "slack.com"      in link.url %}{% set icon = "fab fa-slack" %}
              {% elif "discord.com"    in link.url %}{% set icon = "fab fa-discord" %}
              {% elif "skype.com"      in link.url %}{% set icon = "fab fa-skype" %}
              {% elif "mastodon"       in link.url %}{% set icon = "fab fa-mastodon" %}
              {% elif "vsco"           in link.url %}{% set icon = "fas fa-camera-retro" %}
              {% endif %}
              <a class="link-button {{ user.template }}"
                 href="#" onclick="return false;">
                {% if icon %}<i class="{{ icon }}"></i>{% endif %} {{ link.label }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    {# â€”â€”â€” Desktopâ€profilkort â€”â€”â€” #}
    <div class="profile-card desktop-only"
         style="font-family: {{ user.font_family | default('Inter, sans-serif') }};
                color: {{ user.theme_color or '#333' }};">
      {# â€”â€” Profilbild fÃ¶r desktopvy â€”â€” #}
      {% if user.profile_image %}
        {% if config['UPLOAD_FOLDER'].startswith('/user/data') %}
          <img src="{{ url_for('uploaded_file', filename=user.profile_image) }}" class="profile-img">
        {% else %}
          <img src="{{ url_for('static', filename='uploads/' ~ user.profile_image) }}" class="profile-img">
        {% endif %}
      {% else %}
        <img src="{{ url_for('static', filename='uploads/default-profile.png') }}" class="profile-img">
      {% endif %}

      <h3>@{{ user.display_name or user.username }}</h3>
      <p>{{ user.bio or "Ingen beskrivning Ã¤nnu." }}</p>

      {# â€”â€”â€” Kontaktâ€ikoner som Ã¶ppnar popâ€ups â€”â€”â€” #}
      <div class="contact-icons">
        <button id="openEmailModal" class="small-icon-btn">
          <i class="fas fa-envelope"></i>
        </button>
        <button id="openPhoneModal" class="small-icon-btn">
          <i class="fas fa-phone"></i>
        </button>
      </div>
    </div>

    {# â€”â€” Redigera kontakt (endast mobil) â€”â€” #}
    <div class="contact-icons mobile-only">
      <button id="openEmailModalMobile" class="small-icon-btn">
        <i class="fas fa-envelope"></i>
      </button>
      <button id="openPhoneModalMobile" class="small-icon-btn">
        <i class="fas fa-phone"></i>
      </button>
    </div>

    {# â€”â€”â€” LÃ¤gg tillâ€knapp & modal fÃ¶r nya lÃ¤nkar â€”â€”â€” #}
    <button id="openModal" class="btn action-btn">â• LÃ¤gg till</button>
    <div id="addModal" class="modal">
      <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h3>LÃ¤gg till lÃ¤nk</h3>
        <form method="POST" action="{{ url_for('dashboard.dashboard_view') }}">
          <input name="label" placeholder="Titel (t.ex. LinkedIn)" required>
          <input name="url" placeholder="https://dinsida.com" required>
          <button type="submit">Spara</button>
        </form>
      </div>
    </div>

    {# â€”â€”â€” Lista med befintliga lÃ¤nkar â€”â€”â€” #}
    <div id="link-list" class="links">
      {% for link in sorted_links %}
        {% set icon = "" %}
        {% if "instagram" in link.url %}{% set icon = "fab fa-instagram" %}
        {% elif "facebook" in link.url %}{% set icon = "fab fa-facebook" %}
        {% elif "linkedin" in link.url %}{% set icon = "fab fa-linkedin" %}
        {% elif "youtube" in link.url %}{% set icon = "fab fa-youtube" %}
        {% elif "twitter" in link.url %}{% set icon = "fab fa-twitter" %}
        {% elif "snapchat" in link.url %}{% set icon = "fab fa-snapchat" %}
        {% elif "github" in link.url %}{% set icon = "fab fa-github" %}
        {% elif "tiktok" in link.url %}{% set icon = "fab fa-tiktok" %}
        {% elif "spotify.com"     in link.url %}{% set icon = "fab fa-spotify" %}
        {% elif "soundcloud.com"  in link.url %}{% set icon = "fab fa-soundcloud" %}
        {% elif "vimeo.com"       in link.url %}{% set icon = "fab fa-vimeo-v" %}
        {% elif "twitch.tv"       in link.url %}{% set icon = "fab fa-twitch" %}
        {% elif "dribbble.com"    in link.url %}{% set icon = "fab fa-dribbble" %}
        {% elif "behance.net"     in link.url %}{% set icon = "fab fa-behance" %}
        {% elif "medium.com"      in link.url %}{% set icon = "fab fa-medium" %}
        {% elif "pinterest.com"   in link.url %}{% set icon = "fab fa-pinterest" %}
        {% elif "reddit.com"      in link.url %}{% set icon = "fab fa-reddit" %}
        {% elif "tumblr.com"      in link.url %}{% set icon = "fab fa-tumblr" %}
        {% elif "whatsapp.com"    in link.url %}{% set icon = "fab fa-whatsapp" %}
        {% elif "telegram.me"     in link.url %}{% set icon = "fab fa-telegram" %}
        {% elif "slack.com"       in link.url %}{% set icon = "fab fa-slack" %}
        {% elif "discord.com"     in link.url %}{% set icon = "fab fa-discord" %}
        {% elif "skype.com"       in link.url %}{% set icon = "fab fa-skype" %}
        {% elif "mastodon"        in link.url %}{% set icon = "fab fa-mastodon" %}
        {% elif "vsco"            in link.url %}{% set icon = "fas fa-camera-retro" %}
        {% endif %}
        <div class="link-card"
             data-id="{{ link.id }}"
             data-label="{{ link.label }}"
             data-url="{{ link.url }}"
             data-icon="{{ icon }}"
             data-visible="{{ link.is_visible }}">
          <form class="edit-link-form" style="display:none;" data-link-id="{{ link.id }}">
            <input type="text" name="label" value="{{ link.label }}" required>
            <input type="url" name="url" value="{{ link.url }}" required>
            <button type="submit">ğŸ“‚</button>
          </form>
          <div class="link-main">
            <div class="link-info">
              {% if icon %}<i class="{{ icon }}"></i>{% endif %}
              <span class="link-label">{{ link.label }}</span>
            </div>
            <div class="link-actions">
              <form method="POST"
                    action="{{ url_for('dashboard.toggle_link_visibility', link_id=link.id) }}">
                <button type="submit" class="link-btn">
                  {% if link.is_visible %}ğŸ‘ï¸{% else %}âŒ{% endif %}
                </button>
              </form>
              <a href="#" class="link-btn edit-btn" title="Redigera">âœï¸</a>
              <a href="{{ url_for('dashboard.delete_link', link_id=link.id) }}"
                 class="link-btn" title="Radera">ğŸ—‘ï¸</a>

               {# â€”â€”â€” Redirect av offentlig sida, krÃ¤vs prem konto â€”â€”â€” #}
                <form class="main-link-form" data-link-id="{{ link.id }}" style="display:inline;">
                  {% if user.main_public_link_id == link.id %}
                    <button type="button"
                            class="main-link-btn selected"
                            {% if not current_user.is_premium %} disabled {% endif %}
                            title="Klicka fÃ¶r att avaktivera redirect">
                      ğŸŒŸ Offentlig
                    </button>
                  {% else %}
                    <button type="button"
                            class="main-link-btn"
                            {% if not current_user.is_premium %} disabled {% endif %}
                            title="GÃ¶r denna till din offentliga redirect">
                      Offentlig
                    </button>
                  {% endif %}
                </form>

            </div>
          </div>
        </div>

      {% endfor %}
    </div>
  </div>

  <!-- ğŸ“± FÃ¶rhandsvisning till hÃ¶ger (desktop) -->
  <div class="preview-panel desktop-only">
    <div class="mobile-preview {{ user.template }}"
         style="font-family: {{ user.font_family | default('Inter, sans-serif') }};
                color: {{ user.theme_color or '#fff' }};">
      <div class="profile-card {{ user.template }}"
           style="font-family: inherit; color: inherit;">

        {# â€”â€” Profilbild i previewâ€panel â€”â€” #}
        {% if user.profile_image %}
          {% if config['UPLOAD_FOLDER'].startswith('/user/data') %}
            <img src="{{ url_for('uploaded_file', filename=user.profile_image) }}" class="profile-img">
          {% else %}
            <img src="{{ url_for('static', filename='uploads/' ~ user.profile_image) }}" class="profile-img">
          {% endif %}
        {% else %}
          <img src="{{ url_for('static', filename='uploads/default-profile.png') }}" class="profile-img">
        {% endif %}

        <h3>@{{ user.display_name or user.username }}</h3>
        <p>{{ user.bio or "Ingen beskrivning Ã¤nnu." }}</p>
         {# â€”â€”â€” Kontaktâ€ikoner Ã¤ven i mobilfÃ¶rhandsvisningen â€”â€”â€” #}
                <div class="contact-icons">
          {% if user.show_email %}
            <a href="mailto:{{ user.email }}" class="small-icon-btn">
              <i class="fas fa-envelope"></i>
            </a>
          {% endif %}
          {% if user.show_phone %}
            <a href="tel:{{ user.phone_number }}" class="small-icon-btn">
              <i class="fas fa-phone"></i>
            </a>
          {% endif %}
        </div>
        <div class="links" id="preview-links">
          {% for link in sorted_links if link.is_visible %}
            {% set icon = "" %}
            {% if "instagram" in link.url %}{% set icon = "fab fa-instagram" %}
              {% elif "facebook" in link.url %}{% set icon = "fab fa-facebook" %}
              {% elif "linkedin" in link.url %}{% set icon = "fab fa-linkedin" %}
              {% elif "youtube" in link.url %}{% set icon = "fab fa-youtube" %}
              {% elif "twitter" in link.url %}{% set icon = "fab fa-twitter" %}
              {% elif "snapchat" in link.url %}{% set icon = "fab fa-snapchat" %}
              {% elif "github" in link.url %}{% set icon = "fab fa-github" %}
              {% elif "tiktok" in link.url %}{% set icon = "fab fa-tiktok" %}
              {% elif "spotify.com"     in link.url %}{% set icon = "fab fa-spotify" %}
              {% elif "soundcloud.com"  in link.url %}{% set icon = "fab fa-soundcloud" %}
              {% elif "vimeo.com"       in link.url %}{% set icon = "fab fa-vimeo-v" %}
              {% elif "twitch.tv"       in link.url %}{% set icon = "fab fa-twitch" %}
              {% elif "dribbble.com"    in link.url %}{% set icon = "fab fa-dribbble" %}
              {% elif "behance.net"     in link.url %}{% set icon = "fab fa-behance" %}
              {% elif "medium.com"      in link.url %}{% set icon = "fab fa-medium" %}
              {% elif "pinterest.com"   in link.url %}{% set icon = "fab fa-pinterest" %}
              {% elif "reddit.com"      in link.url %}{% set icon = "fab fa-reddit" %}
              {% elif "tumblr.com"      in link.url %}{% set icon = "fab fa-tumblr" %}
              {% elif "whatsapp.com"    in link.url %}{% set icon = "fab fa-whatsapp" %}
              {% elif "telegram.me"     in link.url %}{% set icon = "fab fa-telegram" %}
              {% elif "slack.com"       in link.url %}{% set icon = "fab fa-slack" %}
              {% elif "discord.com"     in link.url %}{% set icon = "fab fa-discord" %}
              {% elif "skype.com"       in link.url %}{% set icon = "fab fa-skype" %}
              {% elif "mastodon"        in link.url %}{% set icon = "fab fa-mastodon" %}
                {% elif "vsco"      in link.url %}{% set icon = "fas fa-camera-retro" %}
            {% endif %}
            <a class="link-button {{ user.template }}" href="#" onclick="return false;">
              {% if icon %}<i class="{{ icon }}"></i>{% endif %} {{ link.label }}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

{# â€”â€”â€” Eâ€post Popâ€up â€”â€”â€” #}
<div id="emailModal" class="modal">
  <div class="modal-content">
    <button type="button" class="modal-close">&times;</button>
    <h3>Redigera eâ€post</h3>
    <input type="email" id="modalEmail" value="{{ user.email or '' }}" placeholder="Eâ€post"/><br/>
    <label>
      <input type="checkbox" id="modalShowEmail" {% if user.show_email %}checked{% endif %}/>
      Visa eâ€post offentligt
    </label><br/>
    <button id="saveEmail" class="btn-primary">Spara</button>
  </div>
</div>

{# â€”â€”â€” Telefon Popâ€up â€”â€”â€” #}
<div id="phoneModal" class="modal">
  <div class="modal-content">
    <button type="button" class="modal-close">&times;</button>
    <h3>Redigera telefon</h3>
    <input type="tel" id="modalPhone" value="{{ user.phone_number or '' }}" placeholder="Telefonnummer"/><br/>
    <label>
      <input type="checkbox" id="modalShowPhone" {% if user.show_phone %}checked{% endif %}/>
      Visa telefonnummer offentligt
    </label><br/>
    <button id="savePhone" class="btn-primary">Spara</button>
  </div>
</div>

{% if not current_user.is_premium %}
  <a href="https://buy.stripe.com/fZu4gz1x6bx57675pGbEA00?client_reference_id={{ current_user.username }}&prefilled_email={{ current_user.email|urlencode }}"
     class="btn-stripe-premium">
    Skaffa Premium
  </a>
{% endif %}

<div id="premium-popup" style="display:none; position:fixed; z-index:9999; left:0;top:0;width:100vw;height:100vh; background:rgba(0,0,0,0.35); align-items:center; justify-content:center;">
  <div style="background:#fff; padding:2em 2em; border-radius:12px; box-shadow:0 3px 18px rgba(0,0,0,0.11); max-width:360px; margin:auto; text-align:center;">
    <h3>Bli premium!</h3>
    <p>Att vÃ¤lja offentlig redirect Ã¤r en premiumfunktion.<br>Uppgradera fÃ¶r att lÃ¥sa upp!</p>
    <a href="https://buy.stripe.com/fZu4gz1x6bx57675pGbEA00?client_reference_id={{ current_user.username }}&prefilled_email={{ current_user.email|urlencode }}"
       class="btn-stripe-premium" style="margin: 1em 0;display:inline-block;">
      Skaffa Premium
    </a><br>
    <button onclick="hidePremiumPopup()" style="margin-top:0.7em; background:#f3f3f3; border:none; padding:0.5em 1.5em; border-radius:6px;">StÃ¤ng</button>
  </div>
</div>
<script>
function showPremiumPopup() {
  document.getElementById('premium-popup').style.display = 'flex';
}
function hidePremiumPopup() {
  document.getElementById('premium-popup').style.display = 'none';
}
</script>

<style>
  /* Responsivt */
  @media (max-width:600px){ .desktop-only{display:none!important;} .mobile-only{display:flex!important;justify-content:center;} .preview-panel{display:none!important;} }
  @media (min-width:601px){ .mobile-only{display:none!important;} .desktop-only{display:block!important;} .preview-panel{display:block!important;} }

  /* Ikonâ€knappar horisontellt */
  .contact-icons{ display:flex; gap:1rem; justify-content:center; margin:1rem 0; }
  .small-icon-btn{ background:none!important; border:none!important; box-shadow:none!important; padding:.5rem!important; width:auto!important; font-size:1.5rem; cursor:pointer; color: #000!important;}

  /* Modal */
  .modal{ display:none; position:fixed;top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,.5); align-items:center; justify-content:center; z-index:1000; }
  .modal.active{ display:flex; }
  .modal-content{ background:#fff; padding:1.5rem; border-radius:8px; width:90%;max-width:360px; position:relative; }
  .modal-close{ position:absolute;top:.5rem;right:.5rem; background:none;border:none;font-size:1.25rem;cursor:pointer; }

  /* GÃ¶r â€œÃ—â€-knappen liten, svart och utan blÃ¥ bakgrund */
  .modal-close {
    all: unset;             /* tar bort alla tidigare stilar */
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    font-size: 1.25rem;     /* lagom storlek pÃ¥ krysset */
    color: #000;            /* svart */
    cursor: pointer;
  }
</style>


<script>
document.addEventListener('DOMContentLoaded', function() {
  // Editâ€knapp visar formen
  document.querySelectorAll('.edit-btn').forEach(function(btn) {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const card = btn.closest('.link-card');
      const form = card.querySelector('.edit-link-form');
      form.style.display = (form.style.display === 'block') ? 'none' : 'block';
      card.querySelector('.link-main').style.display = (form.style.display === 'block') ? 'none' : 'flex';
    });
  });

  // Editâ€form AJAXâ€submit
  document.querySelectorAll('.edit-link-form').forEach(function(form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const linkId = form.dataset.linkId;
      const label = form.querySelector('input[name="label"]').value.trim();
      const url   = form.querySelector('input[name="url"]').value.trim();

      fetch(`/edit_link_inline/${linkId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ label: label, url: url })
      })
      .then(res => {
        if (res.ok) {
          // DÃ¶lj formen & visa raden igen (eller ladda om sidan om du vill)
          form.style.display = 'none';
          form.closest('.link-card').querySelector('.link-main').style.display = 'flex';
          // Uppdatera label/url i raden:
          form.closest('.link-card').querySelector('.link-label').textContent = label;
        } else {
          alert('Kunde inte spara lÃ¤nk!');
        }
      });
    });
  });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.main-link-form').forEach(form => {
    const btn = form.querySelector('button');
    btn.addEventListener('click', async function(e) {
      e.preventDefault();
      const linkId = form.getAttribute('data-link-id');
      if (!linkId) {
        alert('Kunde inte lÃ¤sa ut lÃ¤nk-id!');
        return false;
      }

      {% if not current_user.is_premium %}
        showPremiumPopup();
        return false;
      {% endif %}

      // Kolla nuvarande tillstÃ¥nd (har knappen class="selected" eller ej?)
      const currentlySelected = btn.classList.contains('selected');

      try {
        let response = await fetch(`/set_main_public_link/${linkId}`, { method: "POST" });
        if (response.ok) {

          // Om den var markerad (selected), sÃ¥ avmarkerar vi
          if (currentlySelected) {
            btn.classList.remove('selected');
            btn.innerText = "Offentlig";
          } else {
            // Om den var avmarkerad, sÃ¥ markerar vi (tog bort pÃ¥ alla + satte pÃ¥ den hÃ¤r)
            document.querySelectorAll('.main-link-btn').forEach(b => {
              b.classList.remove('selected');
              b.innerText = "Offentlig";
            });
            btn.classList.add('selected');
            btn.innerText = "ğŸŒŸ Offentlig";
          }

        } else if (response.status === 403) {
          showPremiumPopup();
        } else {
          alert('Kunde inte uppdatera redirect. Testa igen!');
        }
      } catch (e) {
        alert('NÃ¥got gick fel, testa igen');
      }
    });
  });
});
</script>




<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Sortable + inlineâ€editâ€¦

  // Popâ€up binds
  function bindPop(btnId, modalId, saveId, field, showField) {
    const btn   = document.getElementById(btnId),
          modal = document.getElementById(modalId),
          close = modal.querySelector('.modal-close'),
          save  = document.getElementById(saveId);

    btn.onclick    = () => modal.classList.add('active');
    close.onclick  = () => modal.classList.remove('active');
    window.onclick = e => { if (e.target === modal) modal.classList.remove('active'); };

    save.onclick = async () => {
      const val = document.getElementById(field === 'email' ? 'modalEmail' : 'modalPhone').value;
      const vis = document.getElementById(showField === 'show_email' ? 'modalShowEmail' : 'modalShowPhone').checked;
      const payload = {};
      payload[field]     = val;
      payload[showField] = vis;

      const res = await fetch("{{ url_for('dashboard.update_contact') }}", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        location.reload();
      } else {
        alert('NÃ¥got gick fel');
      }
    };
  }

  // Bind only the actual edit buttons (desktop + mobile share same IDs)
  bindPop('openEmailModal', 'emailModal', 'saveEmail',       'email',        'show_email');
  bindPop('openPhoneModal', 'phoneModal', 'savePhone',       'phone_number', 'show_phone');

  // Mobila editâ€knappar
  bindPop('openEmailModalMobile', 'emailModal','saveEmail', 'email',        'show_email');
  bindPop('openPhoneModalMobile', 'phoneModal','savePhone', 'phone_number', 'show_phone');

  // LÃ¤gg tillâ€modal
  const addModal = document.getElementById('addModal');
  document.getElementById('openModal').onclick  = () => addModal.classList.add('active');
  document.getElementById('closeModal').onclick = () => addModal.classList.remove('active');
  window.addEventListener('click', e => {
    if (e.target === addModal) {
      addModal.classList.remove('active');
    }
  });
});
</script>

{% endblock %}
