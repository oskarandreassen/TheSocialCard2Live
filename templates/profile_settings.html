{% extends "base.html" %}
{% block title %}Profilinst√§llningar{% endblock %}
{% block content %}

<div class="settings-layout right-preview">

  <!-- ‚öôÔ∏è Inst√§llningsformul√§r -->
  <div class="container">
    <h2>Uppdatera din profil</h2>
    <form method="POST" enctype="multipart/form-data" id="profileForm">

      <!-- Profilbild -->
      <label>Profilbild:</label><br>
      {% if user.profile_image %}
        <img src="{{ url_for('static', filename=user.profile_image) }}" class="profile-img"><br>
      {% endif %}
      <input type="file" name="profile_image" accept="image/*"><br><br>

          <!-- Visningsnamn -->
    <label for="display_name">Visningsnamn:</label><br>
    <input
      type="text"
      id="display_name"
      name="display_name"
      maxlength="150"
      placeholder="Hur du vill bli kallad"
      value="{{ user.display_name or '' }}"
    ><br><br>


      <!-- Font -->
      <label for="font_family">Font:</label><br>
      <select name="font_family" id="fontSelect">
        <option value="Inter"     {% if user.font_family == 'Inter'     %}selected{% endif %}>Inter</option>
        <option value="Segoe UI"  {% if user.font_family == 'Segoe UI'  %}selected{% endif %}>Segoe UI</option>
        <option value="Roboto"    {% if user.font_family == 'Roboto'    %}selected{% endif %}>Roboto</option>
        <option value="Georgia"   {% if user.font_family == 'Georgia'   %}selected{% endif %}>Georgia</option>
      </select><br><br>

      <!-- F√§rgtema -->
      <label for="theme_color">F√§rgtema:</label><br>
      <select name="theme_color" id="colorSelect">
        <option value="blue"   {% if user.theme_color == 'blue'   %}selected{% endif %}>Bl√•</option>
        <option value="black"  {% if user.theme_color == 'black'  %}selected{% endif %}>Svart</option>
        <option value="pink"   {% if user.theme_color == 'pink'   %}selected{% endif %}>Rosa</option>
        <option value="green"  {% if user.theme_color == 'green'  %}selected{% endif %}>Gr√∂n</option>
        <option value="purple" {% if user.theme_color == 'purple' %}selected{% endif %}>Lila</option>
      </select><br><br>

      <!-- Bio -->
      <label for="bio">Beskrivning:</label><br>
      <textarea name="bio" id="bioInput" rows="3">{{ user.bio or '' }}</textarea><br><br>

      <!-- Template-v√§ljare -->
      <h3>V√§lj Mall:</h3>
      <div class="template-nav">
        <button id="prevBtn" type="button">‚¨ÖÔ∏è</button>
        <button id="nextBtn" type="button">‚û°Ô∏è</button>
      </div>

      <div class="template-slider" id="template-slider">
        {% for name in ['default','elegant','dark','neon','sun','graffiti','rainbow'] %}
        <label class="template-card {{ name }}" data-name="{{ name }}">
          <input type="radio" name="template" value="{{ name }}"
                 {% if user.template == name %}checked{% endif %}>
          <div class="preview">{{ name|capitalize }}</div>
        </label>
        {% endfor %}
      </div>

      <br><br>
      <button type="submit">Spara inst√§llningar</button>
    </form>
  </div>

  <!-- üì± Mobilpreview & Desktoppreview -->
  {% set visible_links = user.links | selectattr('is_visible') | list %}
  {% for preview_side in ['mobile-only','desktop-only'] %}
  <div class="{{ preview_side }}">
    <div class="mobile-preview {{ user.template }}" id="preview-{{ preview_side }}">
      <div class="profile-card transparent">
        <img src="{{ url_for('static', filename=user.profile_image or 'default-profile.png') }}"
             class="profile-img">
        <h3>@{{ user.display_name or user.username }}</h3>
        <p id="previewBio">{{ user.bio or "Ingen beskrivning √§nnu." }}</p>

        {% if visible_links %}
        <div class="links" id="previewLinks-{{ preview_side }}">
          {% for link in visible_links %}
            {% set icon = "" %}
            {% if "instagram" in link.url %}   {% set icon = "fab fa-instagram" %}
            {% elif "facebook"  in link.url %}  {% set icon = "fab fa-facebook" %}
            {% elif "linkedin"  in link.url %}  {% set icon = "fab fa-linkedin" %}
            {% elif "youtube"   in link.url %}  {% set icon = "fab fa-youtube" %}
            {% elif "twitter"   in link.url %}  {% set icon = "fab fa-twitter" %}
            {% elif "snapchat"  in link.url %}  {% set icon = "fab fa-snapchat" %}
            {% elif "github"    in link.url %}  {% set icon = "fab fa-github" %}
            {% elif "tiktok"    in link.url %}  {% set icon = "fab fa-tiktok" %}
            {% elif "spotify.com"     in link.url %}{% set icon = "fab fa-spotify"     %}
            {% elif "soundcloud.com"  in link.url %}{% set icon = "fab fa-soundcloud"  %}
            {% elif "vimeo.com"       in link.url %}{% set icon = "fab fa-vimeo-v"     %}
            {% elif "twitch.tv"       in link.url %}{% set icon = "fab fa-twitch"      %}
            {% elif "dribbble.com"    in link.url %}{% set icon = "fab fa-dribbble"    %}
            {% elif "behance.net"     in link.url %}{% set icon = "fab fa-behance"     %}
            {% elif "medium.com"      in link.url %}{% set icon = "fab fa-medium"      %}
            {% elif "pinterest.com"   in link.url %}{% set icon = "fab fa-pinterest"   %}
            {% elif "reddit.com"      in link.url %}{% set icon = "fab fa-reddit"      %}
            {% elif "tumblr.com"      in link.url %}{% set icon = "fab fa-tumblr"      %}
            {% elif "whatsapp.com"    in link.url %}{% set icon = "fab fa-whatsapp"    %}
            {% elif "telegram.me"     in link.url %}{% set icon = "fab fa-telegram"    %}
            {% elif "slack.com"       in link.url %}{% set icon = "fab fa-slack"       %}
            {% elif "discord.com"     in link.url %}{% set icon = "fab fa-discord"     %}
            {% elif "skype.com"       in link.url %}{% set icon = "fab fa-skype"       %}
            {% elif "mastodon"        in link.url %}{% set icon = "fab fa-mastodon"    %}
            {% endif %}
            <a class="link-button {{ user.template }}" href="#" onclick="return false;">
              {% if icon %}<i class="{{ icon }}"></i>{% endif %} {{ link.label }}
            </a>
          {% endfor %}
        </div>
        {% else %}
        <p><em>Inga synliga l√§nkar</em></p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}

</div>

<!-- üîÅ Live preview JS + scrollIntoView f√∂r slider -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const slider            = document.getElementById('template-slider');
  const prevBtn           = document.getElementById('prevBtn');
  const nextBtn           = document.getElementById('nextBtn');
  // Plocka ut b√•de mobil- och desktop-preview
  const previewContainers = Array.from(document.querySelectorAll('.mobile-preview'));
  const previewBio        = document.getElementById('previewBio');
  const fontField         = document.getElementById('fontSelect');
  const colorField        = document.getElementById('colorSelect');
  const bioField          = document.getElementById('bioInput');

  const cards = () => Array.from(slider.querySelectorAll('.template-card'));

  // Scrolla s√• att valt kort hamnar mitt i synf√§ltet
  function updateSlider() {
    const checkedCard = slider.querySelector('input:checked')?.closest('.template-card');
    if (checkedCard) {
      checkedCard.scrollIntoView({ behavior: 'smooth', inline: 'center' });
    }
  }

  // Uppdatera alla previews (mobil + desktop)
  function updatePreviewStyles() {
    const theme = slider.querySelector('input:checked').value;
    previewContainers.forEach(pc => {
      pc.className       = 'mobile-preview ' + theme;
      pc.style.fontFamily= fontField.value;
      pc.style.color     = colorField.value;
    });
    previewBio.innerText = bioField.value || "Ingen beskrivning √§nnu.";
  }

  // Aktiv klass p√• det valda kortet
  function updateActiveCard() {
    cards().forEach(card => {
      card.classList.toggle(
        'active',
        card.querySelector('input').checked
      );
    });
  }

  // K√∂r alla uppdateringar
  function updateAll() {
    updateSlider();
    updatePreviewStyles();
    updateActiveCard();
  }

  // Prev/Next-knappar
  prevBtn.addEventListener('click', () => {
    slider.insertBefore(slider.lastElementChild, slider.firstElementChild);
    const all = cards();
    all[Math.floor(all.length/2)].querySelector('input').checked = true;
    updateAll();
  });
  nextBtn.addEventListener('click', () => {
    slider.appendChild(slider.firstElementChild);
    const all = cards();
    all[Math.floor(all.length/2)].querySelector('input').checked = true;
    updateAll();
  });

  // Klick p√• kort
  slider.addEventListener('click', e => {
    const card = e.target.closest('.template-card');
    if (!card) return;
    card.querySelector('input').checked = true;
    updateAll();
  });

  // Live‚Äêpreview vid input‚Äê√§ndringar
  fontField.addEventListener('change', updatePreviewStyles);
  colorField.addEventListener('change', updatePreviewStyles);
  bioField.addEventListener('input',   updatePreviewStyles);

  // Init
  updateAll();
});
</script>

<style>
  /* Mobilvy (‚â§600px): g√∂m det desktop-preview */
  @media only screen and (max-width: 600px) {
    .desktop-only { display: none !important; }
    .mobile-only  { display: block !important; }
  }

  /* Desktopvy (‚â•601px): g√∂m det mobil-preview */
  @media only screen and (min-width: 601px) {
    .mobile-only  { display: none !important; }
    .desktop-only { display: block !important; }
  }
</style>


{% endblock %}
